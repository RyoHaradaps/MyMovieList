{% extends "core/base.html" %}
{% load custom_tags %}

{% block title %}Login - MyMovieList{% endblock %}

{% block content %}
<div class="w-full max-w-md bg-white dark:bg-gray-800 text-black dark:text-white rounded-xl shadow-lg p-8">
    <h2 class="text-2xl font-bold text-center mb-2">Welcome Back to MyMovieList</h2>
    <p class="text-sm text-center mb-6 text-gray-500">
        Login to continue cataloging your favorite movies, comparing with friends, and enjoying personalized
        recommendations.
    </p>

    <div class="text-center mb-4">
        <p class="mb-3 text-lg text-gray-700">Login with</p>
        <div class="flex justify-center space-x-4">
            <button
                class="w-32 flex items-center justify-center space-x-2 bg-gray-800 text-white hover:bg-gray-700 px-4 py-2 rounded font-semibold">
                <i class="fab fa-google text-red-500 text-lg"></i>
                <span class="text-sm">Google</span>
            </button>
            <button
                class="w-32 flex items-center justify-center space-x-2 bg-black text-white hover:bg-gray-800 px-4 py-2 rounded font-semibold">
                <i class="fab fa-apple text-lg"></i>
                <span class="text-sm">Apple</span>
            </button>
        </div>
    </div>

    <div class="flex items-center justify-between my-6">
        <hr class="w-full border-gray-300">
        <span class="px-2 text-gray-500">Or</span>
        <hr class="w-full border-gray-300">
    </div>

    <form method="POST">
        {% csrf_token %}

        <label for="username" class="block mb-1 text-sm font-semibold">Username or Email</label>
        <input type="text" name="username" id="username" required
            class="w-full mb-3 px-4 py-2 rounded-lg bg-gray-100 border border-gray-300 focus:ring-2 focus:ring-indigo-500">

        <label for="password" class="block mb-1 text-sm font-semibold">Password</label>
        <input type="password" name="password" id="password" required
            class="w-full px-4 py-2 rounded-lg bg-gray-100 border border-gray-300 focus:ring-2 focus:ring-indigo-500 mb-2">
        <label class="text-sm mb-3 inline-flex items-center">
            <input type="checkbox" class="mr-2" onclick="togglePassword()"> Show Password
        </label>

        <button type="submit"
            class="w-full bg-indigo-600 text-white font-semibold py-2 rounded-lg hover:bg-indigo-500 transition duration-200">
            Login
        </button>

        <!-- Loading Button (hidden by default) -->
        <button id="loadingBtn" type="button"
            class="w-full px-4 py-2 text-sm font-medium rounded-md bg-indigo-500 text-white flex items-center justify-center mt-2 hidden"
            disabled>
            <svg class="mr-3 size-5 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
            </svg>
            <span id="loadingText">Processing…</span>
        </button>

        <p class="text-xs text-gray-500 mt-4 text-center">
            By clicking Login, you agree to our <a href="#" class="underline">Terms</a> and <a href="#"
                class="underline">Privacy Policy</a>.
        </p>

        <p class="text-center mt-6">
            Don't have an account?
            <a href="{% url 'register' %}"
                class="block w-full mt-2 text-center border border-gray-300 py-2 rounded-lg hover:bg-gray-100">
                Create Account
            </a>
        </p>

        <a href="#" class="block mt-6 text-center text-xs text-gray-400 hover:underline">
            &copy; 2025 MyMovieList Co., Ltd. All Rights Reserved.
        </a>
    </form>
</div>

<script>
    function togglePassword() {
        const pwd = document.getElementById('password');
        pwd.type = pwd.type === 'password' ? 'text' : 'password';
    }

    document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('form');
        if (form) {
            form.addEventListener('submit', function (e) {
                // Hide the submit button(s)
                form.querySelectorAll('button[type="submit"]').forEach(btn => btn.classList.add('hidden'));
                // Show the loading button
                const loadingBtn = document.getElementById('loadingBtn');
                if (loadingBtn) {
                    loadingBtn.classList.remove('hidden');
                    // Optionally set custom text
                    if (form.querySelector('input[name="username"]') && form.querySelector('input[name="password"]')) {
                        document.getElementById('loadingText').innerText = 'Logging in…';
                    }
                }
            });
        }
    });
</script>
{% endblock %}