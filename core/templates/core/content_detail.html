{% extends "core/base.html" %}
{% block title %}{{ content.title }}{% endblock %}

{% block content %}
<div class="flex flex-col md:flex-row gap-8 bg-gray-900 rounded-xl shadow-xl p-6">
    <!-- Left: Poster & User Status -->
    <div class="w-full md:w-1/4 flex flex-col items-center">
        <img src="{{ content.poster_url }}" alt="{{ content.title }}"
            class="rounded-lg shadow-2xl w-full mb-6 border-4 border-gray-800">
        {% if user.is_authenticated %}
        <div class="bg-gray-800 p-4 rounded-lg w-full mt-2 shadow-lg">
            <h3 class="font-semibold mb-2 flex items-center"><i class="fa-solid fa-user-check mr-2"></i>Your Status</h3>
            <!-- Example: Show user's status for this content (replace with real data if available) -->
            <div class="mb-2 flex items-center gap-2">
                <span class="bg-blue-700 px-2 py-1 rounded text-xs font-semibold">Watching</span>
                <span class="bg-gray-700 px-2 py-1 rounded text-xs">Eps: 3 / {{ content.episodes }}</span>
                <span class="bg-yellow-600 px-2 py-1 rounded text-xs flex items-center"><i
                        class="fa-solid fa-star mr-1"></i>8</span>
            </div>
            <a href="#edit-status" class="text-blue-400 hover:underline text-xs"><i
                    class="fa-solid fa-pen mr-1"></i>Edit Status</a>
        </div>
        {% endif %}
    </div>

    <!-- Right: Tabs and Content -->
    <div class="w-full md:w-3/4" x-data="{ tab: 'details' }">
        <!-- Tab Bar -->
        <div class="flex gap-2 mb-6 border-b border-gray-700">
            <button class="px-4 py-2 font-semibold focus:outline-none border-b-2 transition-all duration-200"
                :class="tab === 'details' ? 'border-blue-500 text-blue-400' : 'border-transparent text-gray-400'"
                @click="tab = 'details'">
                <i class="fa-solid fa-circle-info mr-1"></i>Details
            </button>
            <button class="px-4 py-2 font-semibold focus:outline-none border-b-2 transition-all duration-200"
                :class="tab === 'characters' ? 'border-blue-500 text-blue-400' : 'border-transparent text-gray-400'"
                @click="tab = 'characters'">
                <i class="fa-solid fa-users mr-1"></i>Characters
            </button>
            <button class="px-4 py-2 font-semibold focus:outline-none border-b-2 transition-all duration-200"
                :class="tab === 'staff' ? 'border-blue-500 text-blue-400' : 'border-transparent text-gray-400'"
                @click="tab = 'staff'">
                <i class="fa-solid fa-user-tie mr-1"></i>Staff
            </button>
            <button class="px-4 py-2 font-semibold focus:outline-none border-b-2 transition-all duration-200"
                :class="tab === 'episodes' ? 'border-blue-500 text-blue-400' : 'border-transparent text-gray-400'"
                @click="tab = 'episodes'">
                <i class="fa-solid fa-list-ol mr-1"></i>Episodes
            </button>
            <button class="px-4 py-2 font-semibold focus:outline-none border-b-2 transition-all duration-200"
                :class="tab === 'related' ? 'border-blue-500 text-blue-400' : 'border-transparent text-gray-400'"
                @click="tab = 'related'">
                <i class="fa-solid fa-link mr-1"></i>Related
            </button>
            <button class="px-4 py-2 font-semibold focus:outline-none border-b-2 transition-all duration-200"
                :class="tab === 'videos' ? 'border-blue-500 text-blue-400' : 'border-transparent text-gray-400'"
                @click="tab = 'videos'">
                <i class="fa-solid fa-play-circle mr-1"></i>Videos
            </button>
            <button class="px-4 py-2 font-semibold focus:outline-none border-b-2 transition-all duration-200"
                :class="tab === 'share' ? 'border-blue-500 text-blue-400' : 'border-transparent text-gray-400'"
                @click="tab = 'share'">
                <i class="fa-solid fa-share-nodes mr-1"></i>Share
            </button>
        </div>

        <!-- Details Tab -->
        <div x-show="tab === 'details'" class="space-y-4">
            <h1 class="text-3xl font-bold mb-1 flex items-center gap-2">
                <i class="fa-solid fa-film text-blue-400"></i> {{ content.title }}
            </h1>
            {% if content.alt_title or content.synonyms %}
            <div class="mb-2 text-gray-400">
                {% if content.alt_title %}
                <div><span class="font-semibold"><i class="fa-solid fa-language mr-1"></i>Alternative Title:</span> {{
                    content.alt_title }}</div>
                {% endif %}
                {% if content.synonyms %}
                <div><span class="font-semibold"><i class="fa-solid fa-book mr-1"></i>Synonyms:</span> {{
                    content.synonyms }}</div>
                {% endif %}
            </div>
            {% endif %}
            <div class="flex flex-wrap gap-3 mb-4">
                <span class="bg-gray-700 px-3 py-1 rounded flex items-center gap-1"><i
                        class="fa-solid fa-clapperboard"></i> {{ content.content_type|title }}</span>
                <span class="bg-gray-700 px-3 py-1 rounded flex items-center gap-1"><i class="fa-solid fa-calendar"></i>
                    {{ content.year }}</span>
                <span class="bg-gray-700 px-3 py-1 rounded flex items-center gap-1"><i
                        class="fa-solid fa-circle-info"></i> {{ content.status }}</span>
                <span class="bg-gray-700 px-3 py-1 rounded flex items-center gap-1"><i class="fa-solid fa-list-ol"></i>
                    {{ content.episodes }}</span>
                <span class="bg-gray-700 px-3 py-1 rounded flex items-center gap-1"><i
                        class="fa-solid fa-star text-yellow-400"></i> {{ content.rating }}</span>
            </div>
            <div class="mb-6">
                <h2 class="font-semibold text-lg mb-1 flex items-center"><i
                        class="fa-solid fa-align-left mr-2"></i>Synopsis</h2>
                <p class="text-gray-200 leading-relaxed">{{ content.synopsis }}</p>
            </div>
            <div class="mb-4">
                <h2 class="font-semibold text-lg mb-1 flex items-center"><i class="fa-solid fa-music mr-2"></i>Themes
                </h2>
                {% if themes %}
                <div>
                    <span class="font-semibold text-blue-300">Opening Themes:</span>
                    <ul class="list-disc ml-6">
                        {% for theme in themes %}
                        {% if theme.type == 'opening' %}
                        <li>{{ theme.title }}{% if theme.artist %} <span class="text-gray-400">by {{ theme.artist
                                }}</span>{% endif %}</li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </div>
                <div class="mt-2">
                    <span class="font-semibold text-blue-300">Ending Themes:</span>
                    <ul class="list-disc ml-6">
                        {% for theme in themes %}
                        {% if theme.type == 'ending' %}
                        <li>{{ theme.title }}{% if theme.artist %} <span class="text-gray-400">by {{ theme.artist
                                }}</span>{% endif %}</li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </div>
                {% else %}
                <div class="text-gray-400">No theme data available.</div>
                {% endif %}
            </div>
        </div>

        <!-- Characters Tab -->
        <div x-show="tab === 'characters'" class="space-y-4">
            <h2 class="font-semibold text-lg mb-2 flex items-center"><i class="fa-solid fa-users mr-2"></i>Characters
            </h2>
            {% if characters %}
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                {% for char in characters %}
                <div class="bg-gray-800 rounded-lg p-3 flex gap-3 items-center">
                    <img src="{{ char.image_url }}" alt="{{ char.name }}" class="w-16 h-16 object-cover rounded shadow">
                    <div>
                        <div class="font-bold text-blue-300">{{ char.name }}</div>
                        <div class="text-xs text-gray-400">{{ char.get_role_display }}</div>
                        {% with vas=char.voice_actors.all %}
                        {% if vas %}
                        <div class="mt-1 text-xs">
                            <span class="font-semibold text-gray-300">Voice Actors:</span>
                            {% for va in vas %}
                                <span class="text-gray-400">
                                    {{ va.name }}{% if va.language %} ({{ va.language }}){% endif%}
                                </span>
                                {% if not forloop.last %}, {% endif %} 
                            {% endfor %}
                        </div>
                        {% endif %}
                        {% endwith %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-gray-400">No character data available.</div>
            {% endif %}
        </div>

        <!-- Staff Tab -->
        <div x-show="tab === 'staff'" class="space-y-4">
            <h2 class="font-semibold text-lg mb-2 flex items-center"><i class="fa-solid fa-user-tie mr-2"></i>Staff</h2>
            {% if staff %}
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                {% for s in staff %}
                <div class="bg-gray-800 rounded-lg p-3 flex gap-3 items-center">
                    <img src="{{ s.image_url }}" alt="{{ s.name }}" class="w-16 h-16 object-cover rounded shadow">
                    <div>
                        <div class="font-bold text-blue-300">{{ s.name }}</div>
                        <div class="text-xs text-gray-400">{{ s.role }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-gray-400">No staff data available.</div>
            {% endif %}
        </div>

        <!-- Episodes Tab (placeholder) -->
        <div x-show="tab === 'episodes'" class="space-y-4">
            <h2 class="font-semibold text-lg mb-2 flex items-center"><i class="fa-solid fa-list-ol mr-2"></i>Episodes
            </h2>
            <div class="text-gray-400">Episode list coming soon...</div>
        </div>

        <!-- Related Tab -->
        <div x-show="tab === 'related'" class="space-y-4">
            <h2 class="font-semibold text-lg mb-2 flex items-center"><i class="fa-solid fa-link mr-2"></i>Related
                Entries</h2>
            {% if related_entries %}
            <div class="flex overflow-x-auto gap-4 pb-2 custom-scrollbar scrollbar-hide">
                {% for rel in related_entries %}
                <div class="bg-gray-800 rounded-lg shadow-md flex-shrink-0 w-56 p-3 snap-start border border-gray-700">
                    <div class="font-semibold text-blue-300 mb-1 flex items-center gap-1">
                        <i class="fa-solid fa-arrow-right-arrow-left"></i> {{ rel.get_relation_type_display }}
                    </div>
                    <a href="{% url 'content_detail' rel.to_content.pk %}"
                        class="block text-lg font-bold text-blue-400 hover:underline truncate">{{ rel.to_content.title
                        }}</a>
                    {% if rel.to_content.poster_url %}
                    <img src="{{ rel.to_content.poster_url }}" alt="{{ rel.to_content.title }}"
                        class="rounded mt-2 w-full h-32 object-cover">
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-gray-400">No related entries found.</div>
            {% endif %}
        </div>

        <!-- Videos Tab -->
        <div x-show="tab === 'videos'" class="space-y-4">
            <h2 class="font-semibold text-lg mb-2 flex items-center"><i class="fa-solid fa-play-circle mr-2"></i>Videos
            </h2>
            {% if content.trailer_url %}
            <div class="aspect-w-16 aspect-h-9 w-full rounded overflow-hidden">
                <iframe src="{{ content.trailer_url }}" frameborder="0" allowfullscreen class="w-full h-64"></iframe>
            </div>
            {% else %}
            <div class="text-gray-400">No videos available.</div>
            {% endif %}
        </div>

        <!-- Share Tab -->
        <div x-show="tab === 'share'" class="space-y-4">
            <h2 class="font-semibold text-lg mb-2 flex items-center"><i class="fa-solid fa-share-nodes mr-2"></i>Share
            </h2>
            <div class="flex gap-4 items-center">
                <button onclick="navigator.clipboard.writeText(window.location.href)"
                    class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded flex items-center gap-2"><i
                        class="fa-solid fa-link"></i>Copy Link</button>
                <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}" target="_blank"
                    class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded flex items-center gap-2"><i
                        class="fa-brands fa-twitter"></i>Twitter</a>
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank"
                    class="bg-blue-700 hover:bg-blue-800 text-white px-3 py-2 rounded flex items-center gap-2"><i
                        class="fa-brands fa-facebook"></i>Facebook</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}